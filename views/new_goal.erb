
<div class="container">

  <form action="/new_goal" method="post">
    <input type="hidden" name="goal_id" value="<%= goal.id%>">

    <fieldset>

      <% if user.is_admin %>
          <%=
            forme.input(:select,
                        label: "Goal Scope",
                        name: "owner_uniqname",
                        id:   "owner_uniqname",
                        options: [["Personal Goal (#{user.name}", user.uniqname, ]] +
                                  units.map{|u| [u.name, u.abbreviation]},
                        selected: goal.owner_uniqname

            )


          %>
       <% else %>
          <input type="hidden" name="owner_uniqname" value="<%= user.uniqname %>"/>
      <% end %>

      <input type="hidden" name="creator_uniqname" value="<%= user.uniqname %>"/>


    </fieldset>

    <fieldset class="full-width">
      <label for="title">Title</label>
      <p class="help-text">
        Give your goal a title that can quickly identify it's purpose.
      </p>
      <%=  gforme.input :title %>
    </fieldset>

    <fieldset class="full-width">
      <label for="description">Description</label>
      <p class="help-text">
        Write down and explain relevant details.
      </p>
      <%= forme.input(:textarea, name: 'description', value: goal.description) %>

    </fieldset>

    <fieldset class="full-width">
      <label for="associated-goals">Associated Goals</label>
      <p class="help-text">
        Select other unit and department goals that are associated with this personal goal.
        <a href="">View and learn more about these goals.</a>
      </p>
      <input id="associated-goals" name="associated-goals" type="text"/>
    </fieldset>

    <fieldset>
      <label for="platform">"The Platform"</label>
      <p class="help-text">
        To which phase of work on The Platform&trade;, if any, does this goal most apply?
      </p>
      <%= forme.input(:select, name: 'platform', options: platform.map{|x| [x,x]}, selected: goal.platform) %>
    </fieldset>

    <fieldset>
      <label>Status</label>
      <p class="help-text">
        Keep in mind you'll be able to update the status of this goal as it progresses.
      </p>

      <% status_triples.each do |status_value, status_text, checked| %>

        <label class="radio-label">
          <input type="radio" value="<%= status_value %>" name="status" <%=  checked ? "checked='checked'" : '' %>>
          <%= status_text %>
        </label>

      <% end %>


    <fieldset>
      <label for="target_date">Target Date</label>
      <p class="help-text">
        Please enter the year/month you're targeting for completion as YYYY/MM
      </p>
      <%=  forme.input(:text, name: 'target_date', placeholder: 'YYYY/MM', value: goal.target_date_string)%>
    </fieldset>

    <input type="submit" value="Submit Goal" class="button"/>
  </form>

</div>
</main>
<script>
  $('#associated-goals').selectize({
    persist: false,
    maxItems: null,
    valueField: 'uid',
    searchField: ['title'],
    items: <%= parent_goal_ids %>,
    options: <%= selectize_associated_goal_options %>,

    render: {
      item: function (item, escape) {
        return '<div><span>' +
            escape(item.title) +
            '<br /><small><b>' + escape(item.domain) + '</b>, <b>' + escape(item.description) + '</b></small>'
        '</span></div>';
      },
      option: function (item, escape) {
        return '<div><span>' +
            escape(item.title) +
            '<br /><small><b>' + escape(item.domain) + '</b><div>' + escape(item.description) + '</div></small>'
        '</span></div>';
      }
    }
  });
</script>
